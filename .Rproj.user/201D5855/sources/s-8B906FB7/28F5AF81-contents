---
title: Market Demand with Instrumental Variables
author: Felipe Smolski
date: '2019-05-14'
draft: true
categories: []
tags:
  - rstats
  - econometrics
  - bayes
image:
  caption: ''
  focal_point: ''
output:
  blogdown::html_page:
    dev: "svg"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

# Overview

Skipper Seabold, a well known contributor to the PyData community, recently gave a [talk](https://youtu.be/kTo16ieMCi8) titled "What's the Science in Data Science?". His talk presents several methods commonly used in econometrics that could benefit the field of data science if more widely adopted. Some of the methods were:

* Instrumental Variables
* Matching
* Difference-in-Differences

From what I gather, these modeling techniques are popular for discovering causal relationships in observational studies. When an RCT (randomized control trial) is unreasonable then these techniques give us an alternative approach.

I'll be exploring one of these methods called *Instrumental Variables* (or IV). An example use case from Skipper's talk was a [study](https://www.aeaweb.org/articles?id=10.1257/jep.20.2.207) on the **Fulton Fish Market** in NYC.

<img src="/post/2019-03-26-market-price-with-instrumental-variables_files/fulton.jpg" alt="drawing" width="50%"/>

The referenced study estimates the demand curve for fish at the market. Finding the demand curve is unfortunately not as simple as regressing quantity on price. The relationship between price and the quantity of fish sold is not exclusive to demand but includes supply effects at the market. We'll be using IV to account for supply effects to isolate the demand effects.

In this blog post I'll be reproducing a portion of this analysis using R, packages of the [tidyverse](https://www.tidyverse.org/), and the [brms](https://github.com/paul-buerkner/brms) package in R.

## Data

I discovered data related to this study at the following website:
http://people.brandeis.edu/~kgraddy/data.html

Bringing this data into R is very simple. The linked dataset appears to be the cleaned and transformed data used within the paper. Let's read it into our R environment and take a look:

```{r}
library(tidyverse)
fulton <- read_tsv("http://people.brandeis.edu/~kgraddy/datasets/fish.out")
fulton
```

Here is a quick description of the variables we will be using for this work:

Variable | Units | Description
------ | ----- | -----
 qty   | log(pounds) | The total amount of fish sold on a day
 price | log($/lb) | Average price for the day
 day1-day4 | dummy var | Monday-Thurs
 cold | dummy var | Weather on shore
 rainy | dummy var | Rain on shore
 stormy | dummy var | Wind and waves off shore (a 3-day moving average)
 
The paper informs the reader that transactions recorded are of a particular fish species called Whiting. We can get a feel for the total amount of Whiting being sold by reproducing Figure `2` from the paper.

```{r}
# fixing the date column 
fulton %>% 
  mutate(
    date = as.character(date),
    date = parse_date(date, format = "%y%m%d")
  ) %>% 
  ggplot(aes(x = date, y = exp(qty))) +
    geom_col() +
    labs(
      title = "Figure 2",
      subtitle = "Daily Volumes of Whiting",
      x = "Date (December 2, 1991-May 8, 1992)",
      y = "Quantity (pounds)"
      )
```
